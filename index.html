<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discordçµµæ–‡å­—ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=M+PLUS+Rounded+1c:wght@800&family=Noto+Sans+JP:wght@900&family=Reggae+One&family=RocknRoll+One&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #2b2d31;
            --discord-dark: #313338;
            --panel-bg: #1e1f22;
            --border: #444;
            --accent: #5865F2;
            --text: #f2f3f5;
            --text-muted: #b5bac1;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            max-width: 1000px;
            width: 100%;
        }

        @media (max-width: 800px) {
            .container { grid-template-columns: 1fr; }
        }

        h1 { grid-column: 1 / -1; margin: 0 0 10px 0; font-size: 1.4rem; border-bottom: 1px solid var(--border); padding-bottom: 10px; }

        /* å·¦ã‚«ãƒ©ãƒ ï¼šè¨­å®š */
        .controls { display: flex; flex-direction: column; gap: 15px; }

        .control-group {
            background: var(--panel-bg);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #333;
        }
        
        .control-group h3 { margin: 0 0 10px 0; font-size: 0.95rem; color: var(--text-muted); border-bottom: 1px solid #333; padding-bottom: 5px; }

        label { display: block; font-size: 0.8rem; margin-bottom: 4px; color: var(--text-muted); }
        
        textarea, select, input[type="text"], input[type="number"] {
            width: 100%;
            background: #111214;
            border: 1px solid var(--border);
            color: white;
            padding: 8px;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: inherit;
        }
        textarea { resize: vertical; min-height: 60px; }

        .row { display: flex; gap: 10px; align-items: center; }
        .full-width { width: 100%; }

        /* ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
        input[type="range"] { width: 100%; cursor: pointer; accent-color: var(--accent); }

        /* å¤šé‡ç¸å–ã‚Šãƒªã‚¹ãƒˆ */
        #strokeList { display: flex; flex-direction: column; gap: 8px; margin-bottom: 10px; }
        .stroke-item {
            display: flex; gap: 5px; align-items: center;
            background: #2b2d31; padding: 5px; border-radius: 4px;
        }
        .stroke-item input[type="color"] { width: 30px; height: 30px; border: none; padding: 0; background: none; cursor: pointer; }
        .btn-sm {
            padding: 4px 8px; font-size: 0.8rem; background: #444; border: none; color: white; border-radius: 3px; cursor: pointer;
        }
        .btn-add { background: var(--accent); width: 100%; padding: 8px; color: white; border:none; border-radius: 4px; cursor: pointer;}
        .btn-remove { background: #d83c3e; }

        /* å³ã‚«ãƒ©ãƒ ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
        .preview-area {
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .canvas-bg {
            background-image: 
                linear-gradient(45deg, #2a2a2a 25%, transparent 25%), 
                linear-gradient(-45deg, #2a2a2a 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #2a2a2a 75%), 
                linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            border: 2px solid #555;
        }
        canvas { display: block; }

        /* Discord Preview */
        .discord-box {
            background: var(--discord-dark);
            width: 100%;
            padding: 15px;
            border-radius: 6px;
            box-sizing: border-box;
        }
        .discord-msg { display: flex; gap: 10px; align-items: flex-start; margin-bottom: 10px; }
        .avatar { width: 40px; height: 40px; background: var(--accent); border-radius: 50%; flex-shrink: 0; }
        .msg-body { font-size: 0.95rem; line-height: 1.4; color: #dbdee1; }
        .username { font-weight: bold; font-size: 0.9rem; color: white; margin-right: 5px; }
        .timestamp { font-size: 0.7rem; color: #949BA4; }
        
        .emoji-jumbo { width: 48px; height: 48px; object-fit: contain; }
        .emoji-inline { width: 22px; height: 22px; vertical-align: bottom; object-fit: contain; }

        .btn-download {
            background: #248046; color: white; font-weight: bold; padding: 15px; width: 100%; border: none; border-radius: 4px; font-size: 1.1rem; cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .btn-download:hover { background: #1a6334; }
        
        .file-input-wrapper { margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Discord çµµæ–‡å­—ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ Pro</h1>

    <div class="controls">
        
        <div class="control-group">
            <h3>æ–‡å­—å…¥åŠ› (è‡ªå‹•åœ§ç¸®ãƒ»æ”¹è¡Œå¯¾å¿œ)</h3>
            <textarea id="textInput" placeholder="æ”¹è¡Œã§&#10;2è¡Œã«&#10;ãªã‚Šã¾ã™">è¦‹åˆ‡ã‚Œ&#10;ã‚‹ã‹ã‚‚</textarea>
            
            <div class="row" style="margin-top:10px;">
                <div class="full-width">
                    <label>ãƒ•ã‚©ãƒ³ãƒˆé¸æŠ</label>
                    <select id="fontFamily">
                        <option value="'Noto Sans JP', sans-serif">Noto Sans JP (æ¥µå¤ªã‚´ã‚·ãƒƒã‚¯)</option>
                        <option value="'RocknRoll One', sans-serif">RocknRoll One (ãƒãƒƒãƒ—)</option>
                        <option value="'Reggae One', serif">Reggae One (åŠ‡ç”»é¢¨)</option>
                        <option value="'DotGothic16', sans-serif">DotGothic16 (ãƒ‰ãƒƒãƒˆçµµ)</option>
                        <option value="'M PLUS Rounded 1c', sans-serif">M PLUS Rounded (ä¸¸æ–‡å­—)</option>
                        <option value="Impact, sans-serif">Impact (æ¬§æ–‡)</option>
                    </select>
                </div>
            </div>
            
            <div class="file-input-wrapper">
                <label>æ‰‹æŒã¡ãƒ•ã‚©ãƒ³ãƒˆã‚’è¿½åŠ  (.ttf/.woff)</label>
                <input type="file" id="fontUpload" accept=".ttf,.otf,.woff,.woff2">
            </div>

            <div class="row" style="margin-top:10px;">
                <div class="full-width">
                    <label>åŸºæœ¬ã‚µã‚¤ã‚º: <span id="sizeVal">100</span>px</label>
                    <input type="range" id="fontSize" min="20" max="150" value="100">
                </div>
            </div>
            <div class="row">
                <div class="full-width">
                    <label>è¡Œé–“ (Line Height)</label>
                    <input type="range" id="lineHeight" min="0.5" max="2.0" step="0.1" value="1.0">
                </div>
            </div>
            <div class="row">
                <div class="full-width">
                    <label>å‚ç›´ä½ç½®èª¿æ•´</label>
                    <input type="range" id="offsetY" min="-64" max="64" value="0">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>æ–‡å­—è‰² (Fill)</h3>
            <label><input type="checkbox" id="useGradient" checked> ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨</label>
            <div class="row" style="margin-top:5px;">
                <input type="color" id="color1" value="#FF0055" title="ä¸Š/é–‹å§‹è‰²">
                <span style="font-size:0.8rem;">To</span>
                <input type="color" id="color2" value="#FFCC00" title="ä¸‹/çµ‚äº†è‰²">
                <input type="range" id="gradAngle" min="0" max="360" value="90" title="è§’åº¦">
            </div>
        </div>

        <div class="control-group">
            <h3>å¤šé‡ç¸å–ã‚Š (Stroke Layers)</h3>
            <div style="font-size:0.75rem; color:#aaa; margin-bottom:5px;">ä¸ŠãŒå†…å´ã€ä¸‹ãŒå¤–å´ã«ãªã‚Šã¾ã™</div>
            <div id="strokeList">
                </div>
            <button class="btn-add" id="addStrokeBtn">+ ç¸å–ã‚Šã‚’è¿½åŠ </button>
        </div>

        <div class="control-group">
            <h3>å½± (Shadow)</h3>
            <label><input type="checkbox" id="useShadow" checked> ãƒ‰ãƒ­ãƒƒãƒ—ã‚·ãƒ£ãƒ‰ã‚¦</label>
            <div class="row" style="margin-top:5px;">
                <input type="color" id="shadowColor" value="#000000">
                <div class="full-width">
                    <label>ã¼ã‹ã—</label>
                    <input type="range" id="shadowBlur" min="0" max="20" value="4">
                </div>
            </div>
            <div class="row">
                <div class="full-width">
                    <label>è·é›¢ X</label>
                    <input type="range" id="shadowX" min="-20" max="20" value="4">
                </div>
                <div class="full-width">
                    <label>è·é›¢ Y</label>
                    <input type="range" id="shadowY" min="-20" max="20" value="4">
                </div>
            </div>
        </div>

    </div>

    <div class="preview-area">
        <div class="canvas-bg">
            <canvas id="canvas" width="128" height="128"></canvas>
        </div>
        <div style="font-size:0.8rem; color:#aaa;">128x128 px (256KBåˆ¶é™å¯¾å¿œ)</div>

        <div class="discord-box">
            <div style="font-size:0.75rem; color:#949BA4; margin-bottom:10px;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
            
            <div class="discord-msg">
                <div class="avatar"></div>
                <div class="msg-body">
                    <div>
                        <span class="username">User</span>
                        <span class="timestamp">ä»Šæ—¥ 12:34</span>
                    </div>
                    <img id="previewJumbo" class="emoji-jumbo" src="">
                </div>
            </div>

            <div class="discord-msg">
                <div class="avatar"></div>
                <div class="msg-body">
                    <div>
                        <span class="username">User</span>
                        <span class="timestamp">ä»Šæ—¥ 12:35</span>
                    </div>
                    <div>
                        ã“ã‚Œã¯<img id="previewInline" class="emoji-inline" src="">Geminiã§ä½œã£ãŸã‚ˆ
                    </div>
                </div>
            </div>
        </div>

        <button class="btn-download" id="downloadBtn">ç”»åƒã‚’ä¿å­˜ (PNG)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // UIå‚ç…§
    const ui = {
        text: document.getElementById('textInput'),
        font: document.getElementById('fontFamily'),
        fontUpload: document.getElementById('fontUpload'),
        size: document.getElementById('fontSize'),
        sizeVal: document.getElementById('sizeVal'),
        lineHeight: document.getElementById('lineHeight'),
        offsetY: document.getElementById('offsetY'),
        
        useGradient: document.getElementById('useGradient'),
        color1: document.getElementById('color1'),
        color2: document.getElementById('color2'),
        gradAngle: document.getElementById('gradAngle'),

        strokeList: document.getElementById('strokeList'),
        addStrokeBtn: document.getElementById('addStrokeBtn'),

        useShadow: document.getElementById('useShadow'),
        shadowColor: document.getElementById('shadowColor'),
        shadowBlur: document.getElementById('shadowBlur'),
        shadowX: document.getElementById('shadowX'),
        shadowY: document.getElementById('shadowY')
    };

    const previews = {
        jumbo: document.getElementById('previewJumbo'),
        inline: document.getElementById('previewInline')
    };

    // ç¸å–ã‚Šãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†ï¼ˆåˆæœŸå€¤ï¼šç™½ã®ç¸å–ã‚Šï¼‰
    let strokes = [
        { color: '#FFFFFF', width: 8 },
        { color: '#000000', width: 4 } // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§äºŒé‡ç¸å–ã‚Šã«ã—ã¦ãŠã
    ];

    // --- æ©Ÿèƒ½ï¼šãƒ•ã‚©ãƒ³ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ---
    ui.fontUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (evt) => {
            const fontName = 'UploadedFont_' + Date.now();
            const fontFace = new FontFace(fontName, evt.target.result);
            
            fontFace.load().then((loadedFace) => {
                document.fonts.add(loadedFace);
                
                // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ ã—ã¦é¸æŠ
                const option = document.createElement('option');
                option.text = `ğŸ“‚ ${file.name}`;
                option.value = fontName;
                ui.font.add(option, 0); // å…ˆé ­ã«è¿½åŠ 
                ui.font.selectedIndex = 0;
                
                draw();
            }).catch(err => {
                alert('ãƒ•ã‚©ãƒ³ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
            });
        };
        reader.readAsArrayBuffer(file);
    });

    // --- æ©Ÿèƒ½ï¼šå¤šé‡ç¸å–ã‚ŠUI ---
    function renderStrokeList() {
        ui.strokeList.innerHTML = '';
        strokes.forEach((stroke, index) => {
            const div = document.createElement('div');
            div.className = 'stroke-item';
            div.innerHTML = `
                <span style="font-size:0.8rem; color:#aaa;">#${index+1}</span>
                <input type="color" value="${stroke.color}" oninput="updateStroke(${index}, 'color', this.value)">
                <input type="range" min="0" max="30" value="${stroke.width}" oninput="updateStroke(${index}, 'width', this.value)" style="width:80px;">
                <button class="btn-sm btn-remove" onclick="removeStroke(${index})">Ã—</button>
            `;
            ui.strokeList.appendChild(div);
        });
        draw();
    }

    window.updateStroke = (index, key, value) => {
        strokes[index][key] = key === 'width' ? parseInt(value) : value;
        draw();
    };

    window.removeStroke = (index) => {
        strokes.splice(index, 1);
        renderStrokeList();
    };

    ui.addStrokeBtn.addEventListener('click', () => {
        // å‰ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨åŒã˜è¨­å®šã§è¿½åŠ ï¼ˆä½¿ã„ã‚„ã™ã•ã®ãŸã‚ï¼‰
        const last = strokes[strokes.length - 1] || { color: '#000000', width: 5 };
        strokes.push({ color: last.color === '#FFFFFF' ? '#000000' : '#FFFFFF', width: 5 });
        renderStrokeList();
    });

    // --- ãƒ¡ã‚¤ãƒ³æç”»å‡¦ç† ---
    function draw() {
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const text = ui.text.value;
        const lines = text.split('\n'); // æ”¹è¡Œã§åˆ†å‰²
        const baseSize = parseInt(ui.size.value);
        const fontFamily = ui.font.value;
        const lineHeightScale = parseFloat(ui.lineHeight.value);
        const offsetY = parseInt(ui.offsetY.value);

        ui.sizeVal.textContent = baseSize;

        // ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
        ctx.font = `900 ${baseSize}px ${fontFamily}`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.lineJoin = 'round';
        ctx.miterLimit = 2; // ãƒˆã‚²ãƒˆã‚²é˜²æ­¢

        // å…¨ä½“ã®é«˜ã•è¨ˆç®—ï¼ˆå‚ç›´ä¸­å¤®å¯„ã›ã®ãŸã‚ï¼‰
        const totalHeight = lines.length * baseSize * lineHeightScale;
        const startY = (canvas.height - totalHeight) / 2 + (baseSize * lineHeightScale / 2) + offsetY;

        // æç”»é–¢æ•°ï¼ˆãƒ¢ãƒ¼ãƒ‰ï¼šshadow, stroke, fillï¼‰
        // strokeIndexã¯ç¸å–ã‚Šã®æ™‚ã«ä½¿ã†
        const renderText = (mode, strokeIndex = -1) => {
            lines.forEach((line, i) => {
                if (!line) return; // ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—

                const y = startY + (i * baseSize * lineHeightScale);
                const centerX = canvas.width / 2;

                // --- è‡ªå‹•åœ§ç¸® (Squeeze) ãƒ­ã‚¸ãƒƒã‚¯ ---
                // ãƒ†ã‚­ã‚¹ãƒˆã®å¹…ã‚’è¨ˆæ¸¬
                const metrics = ctx.measureText(line);
                const textWidth = metrics.width;
                const maxW = 120; // ä½™ç™½ã‚’å°‘ã—æ®‹ã™

                let scaleX = 1;
                // ç¸å–ã‚ŠãŒã‚ã‚‹å ´åˆã€ãã®åˆ†å¹…ãŒåºƒãŒã‚‹ã®ã§è€ƒæ…®ã™ã‚‹
                let maxStroke = 0;
                strokes.forEach(s => maxStroke += s.width);
                const realWidth = textWidth + (maxStroke * 2);

                if (realWidth > maxW) {
                    scaleX = maxW / realWidth;
                }

                ctx.save();
                ctx.translate(centerX, y);
                if (scaleX < 1) {
                    ctx.scale(scaleX, 1); // æ¨ªã ã‘æ½°ã™
                }

                if (mode === 'shadow') {
                    ctx.shadowColor = ui.shadowColor.value;
                    ctx.shadowBlur = parseInt(ui.shadowBlur.value);
                    ctx.shadowOffsetX = parseInt(ui.shadowX.value);
                    ctx.shadowOffsetY = parseInt(ui.shadowY.value);
                    // å½±å°‚ç”¨ã«å¡—ã‚Šã¤ã¶ã—ï¼ˆè‰²ã¯é–¢ä¿‚ãªã„ãŒå½¢ã‚’ä½œã‚‹ãŸã‚ï¼‰
                    ctx.fillStyle = 'black'; 
                    
                    // ç¸å–ã‚ŠãŒã‚ã‚‹å ´åˆã¯ã€ä¸€ç•ªå¤ªã„ç¸å–ã‚Šã®å½¢ã«å½±ã‚’è½ã¨ã™ã®ãŒè‡ªç„¶
                    if (strokes.length > 0) {
                        // å…¨ç¸å–ã‚Šå¹…ã®åˆè¨ˆ
                        let totalWidth = 0;
                        strokes.forEach(s => totalWidth += s.width);
                        ctx.lineWidth = totalWidth * 2;
                        ctx.strokeText(line, 0, 0);
                        // ä¸­ã‚‚åŸ‹ã‚ã‚‹
                        ctx.fillText(line, 0, 0);
                    } else {
                        ctx.fillText(line, 0, 0);
                    }

                } else if (mode === 'stroke') {
                    // å¤šé‡ç¸å–ã‚Šã®ãƒ­ã‚¸ãƒƒã‚¯:
                    // å¤–å´ã®ç¸å–ã‚Šã‚’æãã«ã¯ã€ã€Œãã‚Œã‚ˆã‚Šå†…å´ã®ç¸å–ã‚Šå¹…ã®åˆè¨ˆ + è‡ªåˆ†ã®å¹…ã€ã§æç”»ã—ã€
                    // å¾Œã‹ã‚‰å†…å´ãŒä¸Šæ›¸ãã•ã‚Œã‚‹ã“ã¨ã§å±¤ã«è¦‹ãˆã‚‹ï¼ˆPainter's Algorithmï¼‰
                    
                    const currentStroke = strokes[strokeIndex];
                    
                    // è‡ªåˆ†ã‚ˆã‚Šã€Œå†…å´ã€ï¼ˆãƒªã‚¹ãƒˆã®ä¸Šä½ï¼‰ã«ã‚ã‚‹ç¸å–ã‚Šã®å¹…ã‚’åˆè¨ˆã™ã‚‹
                    // ãƒªã‚¹ãƒˆé †: 0(å†…) -> N(å¤–)
                    // æç”»é †: N(å¤–) -> 0(å†…) ã¨å›ã—ã¦ã„ã‚‹ã®ã§ã€
                    // ä»Šæç”»ã—ã¦ã„ã‚‹strokeIndexã‚ˆã‚Šå°ã•ã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®widthã‚’è¶³ã™
                    let innerWidths = 0;
                    for(let j=0; j < strokeIndex; j++) {
                        innerWidths += strokes[j].width;
                    }

                    // ç·šã®å¤ªã• = (å†…å´ã®å¹…åˆè¨ˆ + è‡ªåˆ†ã®å¹…) * 2 (åŠå¾„->ç›´å¾„)
                    ctx.strokeStyle = currentStroke.color;
                    ctx.lineWidth = (innerWidths + currentStroke.width) * 2;
                    ctx.strokeText(line, 0, 0);

                } else if (mode === 'fill') {
                    if (ui.useGradient.checked) {
                        const angle = parseInt(ui.gradAngle.value) * (Math.PI / 180);
                        const dist = baseSize; 
                        // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³åº§æ¨™è¨ˆç®— (ç°¡æ˜“)
                        const x1 = -Math.cos(angle) * dist/2;
                        const y1 = -Math.sin(angle) * dist/2;
                        const x2 = Math.cos(angle) * dist/2;
                        const y2 = Math.sin(angle) * dist/2;
                        
                        const grad = ctx.createLinearGradient(x1, y1, x2, y2);
                        grad.addColorStop(0, ui.color1.value);
                        grad.addColorStop(1, ui.color2.value);
                        ctx.fillStyle = grad;
                    } else {
                        ctx.fillStyle = ui.color1.value;
                    }
                    ctx.fillText(line, 0, 0);
                }

                ctx.restore();
            });
        };

        // 1. å½±ã‚’æç”»
        if (ui.useShadow.checked) {
            ctx.save();
            renderText('shadow');
            ctx.restore();
        }

        // 2. ç¸å–ã‚Šã‚’æç”»ï¼ˆå¤–å´ã‹ã‚‰é †ã«æãï¼ãƒªã‚¹ãƒˆã®é€†é †ï¼‰
        // strokesé…åˆ—: [0:å†…å´, 1:å¤–å´...]
        // æç”»é †: å¤–å´(1) -> å†…å´(0)
        for (let i = strokes.length - 1; i >= 0; i--) {
            renderText('stroke', i);
        }

        // 3. æ–‡å­—æœ¬ä½“ã‚’æç”»
        renderText('fill');

        updatePreviews();
    }

    function updatePreviews() {
        const url = canvas.toDataURL('image/png');
        previews.jumbo.src = url;
        previews.inline.src = url;
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    [ui.text, ui.font, ui.size, ui.lineHeight, ui.offsetY, 
     ui.color1, ui.color2, ui.gradAngle, ui.useGradient, 
     ui.shadowColor, ui.shadowBlur, ui.shadowX, ui.shadowY, ui.useShadow
    ].forEach(el => {
        el.addEventListener('input', draw);
    });

    // åˆæœŸåŒ–
    renderStrokeList();
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    document.getElementById('downloadBtn').addEventListener('click', () => {
        const link = document.createElement('a');
        let name = ui.text.value.replace(/\n/g, '_').substring(0, 10) || 'emoji';
        link.download = `${name}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    });

    // ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å¾…ã¡
    window.addEventListener('load', () => setTimeout(draw, 500));

</script>
</body>
</html>
