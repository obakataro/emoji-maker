<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Discord Emoji Maker Ultra</title>
<style>
body { background:#111; color:#eee; font-family:sans-serif; }
.controls { display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:8px; }
canvas { background:transparent; border:1px dashed #444; }
.previewRow { display:flex; gap:6px; background:#222; padding:8px; margin-top:8px; }
.previewRow img { width:32px; height:32px; }
</style>
</head>
<body>
<h1>Discord 絵文字メーカー</h1>

<div class="controls">
<input id="text" value="神" />
<input id="name" placeholder="保存名 (未設定→emoji)" />
<input id="size" type="range" min="80" max="140" value="120" />
<input id="fill" type="color" value="#FFD400" />
<input id="stroke" type="color" value="#000000" />
<input id="strokeW" type="range" min="2" max="12" value="6" />
<label><input id="neon" type="checkbox" checked /> ネオン</label>
<button onclick="savePreset()">保存</button>
<button onclick="download()">PNG出力</button>
</div>

<canvas id="c" width="128" height="128"></canvas>
<h3>リアクションプレビュー</h3>
<div id="row" class="previewRow"></div>

<script>
const c = document.getElementById('c');
const ctx = c.getContext('2d');
const row = document.getElementById('row');

function autoStroke(fill) {
  const c = parseInt(fill.slice(1),16);
  const l = ((c>>16&255)*0.299)+((c>>8&255)*0.587)+((c&255)*0.114);
  return l>140 ? '#000' : '#fff';
}

function draw() {
  ctx.clearRect(0,0,128,128);
  const t = text.value;
  const s = size.value;
  const f = fill.value;
  const sw = strokeW.value;
  const sc = autoStroke(f);
  ctx.font = `900 ${s}px 'Noto Sans JP',sans-serif`;
  ctx.textAlign='center'; ctx.textBaseline='middle';
  if(neon.checked){ ctx.shadowBlur=20; ctx.shadowColor=f; }
  ctx.lineWidth=sw; ctx.strokeStyle=sc;
  ctx.strokeText(t,64,64);
  ctx.shadowBlur=0;
  ctx.fillStyle=f;
  ctx.fillText(t,64,64);
}

['text','size','fill','strokeW','neon'].forEach(id=>{
  document.getElementById(id).addEventListener('input',draw);
});

function download(){
  const a=document.createElement('a');
  const n=name.value||'emoji';
  a.download=n+'.png';
  a.href=c.toDataURL();
  a.click();
}

function savePreset(){
  const n=name.value||'emoji';
  const data={ text:text.value,size:size.value,fill:fill.value,strokeW:strokeW.value,neon:neon.checked };
  localStorage.setItem('emoji_'+n,JSON.stringify(data));
  renderRow();
}

function renderRow(){
  row.innerHTML='';
  Object.keys(localStorage).filter(k=>k.startsWith('emoji_')).forEach(k=>{
    const d=JSON.parse(localStorage.getItem(k));
    const cv=document.createElement('canvas'); cv.width=32; cv.height=32;
    const x=cv.getContext('2d');
    x.font=`900 ${d.size/4}px sans-serif`; x.textAlign='center'; x.textBaseline='middle';
    x.lineWidth=d.strokeW/4; x.strokeStyle=autoStroke(d.fill);
    if(d.neon){ x.shadowBlur=6; x.shadowColor=d.fill; }
    x.strokeText(d.text,16,16); x.shadowBlur=0; x.fillStyle=d.fill; x.fillText(d.text,16,16);
    row.appendChild(cv);
  });
}

draw(); renderRow();
</script>
</body>
</html>
